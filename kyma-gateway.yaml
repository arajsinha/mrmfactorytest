# This is the native Istio Gateway resource. It tells the main Kyma entry point
# (the Istio ingress gateway) to open a port and listen for traffic for our host.
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: mrm-cell-gateway
spec:
  # This selector is crucial. It tells this Gateway to apply its rules
  # to the default, public-facing load balancer in Kyma.
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "mrm-cell.c9ff5e0.kyma.ondemand.com"
---
# This is the native Istio VirtualService. This is the core routing rule.
# It tells the Gateway what to do with the traffic it receives.
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: mrm-cell-virtualservice
spec:
  hosts:
  - "mrm-cell.c9ff5e0.kyma.ondemand.com"
  gateways:
  - mrm-cell-gateway # This links the VirtualService to the Gateway we defined above.
  http:
  - route:
    - destination:
        # This is the internal Kubernetes address of our application's service.
        host: mrm-cell-public.default.svc.cluster.local
        port:
          number: 9081